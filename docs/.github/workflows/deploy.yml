name: Deploy VitePress Site to GitHub Pages

on:
  push:
    branches:
      - main # Deploy only when pushing to the main branch

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码仓库
      - name: Checkout Repository
        uses: actions/checkout@v4 # Updated version
        with:
          fetch-depth: 0 # Fetches all history for git info like last updated time

      # 2. 设置 Node.js 环境 (matching your local v22)
      - name: Set up Node.js
        uses: actions/setup-node@v4 # Updated version
        with:
          node-version: '22'
          cache: 'npm' # Enable caching for npm dependencies
          cache-dependency-path: 'docs/package-lock.json' # Specify lock file location

      # 3. 安装项目依赖 (using npm ci for consistency)
      #    This step assumes your package.json/package-lock.json correctly list
      #    vitepress@1.0.0-alpha.28 and markdown-it-mathjax3
      - name: Install Dependencies
        working-directory: ./docs # <--- Run npm commands in the 'docs' directory
        run: npm ci

      # 4. 构建 VitePress 项目
      #    Verify 'docs:build' is the correct script name in your docs/package.json
      - name: Build
        working-directory: ./docs # <--- Run npm commands in the 'docs' directory
        run: npm run docs:build # <-- Use the standard vitepress build script name

      # 5. 配置 GitHub Pages (required for actions/deploy-pages)
      - name: Setup Pages
        uses: actions/configure-pages@v5 # Use the official action

      # 6. 上传构建产物
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3 # Use the official action
        with:
          # Upload the default VitePress build output directory
          path: ./docs/.vitepress/dist

      # 7. 部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # Use the official action
