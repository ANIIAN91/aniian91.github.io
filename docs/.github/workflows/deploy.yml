name: Deploy VitePress Site to GitHub Pages

on:
  push:
    branches:
      - main # Deploy only when pushing to the main branch

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码仓库
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetches all history for git info like last updated time

      # 2. 设置 Node.js 环境 (matching your local v22)
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm' # Enable caching for npm dependencies
          # cache-dependency-path defaults to package-lock.json at root, which is now correct

      # 3. 安装项目依赖 (using npm ci for consistency)
      #    No working-directory needed, as package.json is at the root
      - name: Install Dependencies
        run: npm ci

      # 4. 构建 VitePress 项目
      #    Verify 'docs:build' is the correct script name in your package.json
      #    No working-directory needed
      - name: Build
        run: npm run docs:build # <-- Use the standard vitepress build script name (or your actual script name)

      # 5. 配置 GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # 6. 上传构建产物
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Upload the default VitePress build output directory relative to root
          path: ./.vitepress/dist # <--- Path relative to repository root

      # 7. 部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
